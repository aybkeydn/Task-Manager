<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√∂revlerim </title>
    <link rel="stylesheet" href="../styles/main.css">
</head>
<body>
    <style>
        body {
   background-color: white;
    animation: color 8s infinite linear; 
  }

          @keyframes color {
    0%   { background: #f2e5f9;  }
    25%  { background: #974ebe; }
    50%  { background: #3b2464c0; }
    75%  { background: #974ebe; }
    100% { background: #f2e5f9;  }
  }

  #category-back{
            font-family: 'Roboto Mono', monospace;
        color: rgb(254, 247, 255);
        text-shadow: 2px 5px 6px rgba(0,0,0,0.2);
        letter-spacing: 3px;
        border: none;
        border-radius: 20px;
        padding: 12px 25px;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.4s ease-in-out;
        font-weight: bold;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        background-color: #ff0000;
        position: relative; 
        display: flex;
        justify-content: center;
        bottom: 140px;
        right: 50px;
        }


        #category-back:hover{
        box-shadow: 0 0 20px rgba(0, 9, 4, 0.8);
        transform: scale(1.3);
        }


  
    </style>
<div class="tasks-container">
    <button class="back-button" id="category-back" onclick="window.location.href='dashboard.html'  ">Geri d√∂n</button>
    <!-- Typewriter sƒ±nƒ±fƒ± ile ba≈ülƒ±k -->
    <div class="tasks-header typewriter" style="position: relative;">
        <!-- Zƒ±playan Top -->
        <div class="ball"></div>

        <h1>G√∂revlerim</h1>
    </div>

    <button id="addTaskBtn" class="quick-action-btn" 
       >Yeni G√∂rev</button>
</div>



    

        <div id="taskList" class="task-list">
            <!-- G√∂revler dinamik olarak buraya eklenecek -->
        </div>
    </div>

    <!-- G√∂rev Ekleme/D√ºzenleme Modalƒ± -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">Yeni G√∂rev</h2>
            <form id="taskForm">
                <input type="hidden" id="taskId">
                <div class="form-group">
                    <label for="taskTitle">Ba≈ülƒ±k</label>
                    <input type="text" id="taskTitle" required>
                </div>
                <div class="form-group">
                    <label for="taskDescription">A√ßƒ±klama</label>
                    <textarea id="taskDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="taskDueDate">Biti≈ü Tarihi</label>
                    <input type="date" id="taskDueDate">
                </div>
                <div class="form-group">
                    <label for="taskPriority">√ñncelik</label>
                    <select id="taskPriority">
                        <option value="1">D√º≈ü√ºk</option>
                        <option value="2">Orta</option>
                        <option value="3">Y√ºksek</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" id="cancelTaskBtn" class="quick-action-btn" style="background-color: #e8240e;">ƒ∞ptal</button>
                    <button type="submit" class="quick-action-btn" style="background-color: #24e80e;">Kaydet</button>
                </div>
            </form>
        </div>
    </div>

    <script src="../scripts/api.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const taskList = document.getElementById('taskList');
            const addTaskBtn = document.getElementById('addTaskBtn');
            const taskModal = document.getElementById('taskModal');
            const modalTitle = document.getElementById('modalTitle');
            const taskForm = document.getElementById('taskForm');
            const cancelTaskBtn = document.getElementById('cancelTaskBtn');

            // G√∂revleri getir ve listele
            async function loadTasks() {
                try {
                    const tasks = await ApiService.request('/Tasks', 'GET', null, true);
                    taskList.innerHTML = ''; // √ñnceki g√∂revleri temizle

                    if (tasks.length === 0) {
                        taskList.innerHTML = '<p style="text-align:center; padding:20px;">Hen√ºz g√∂rev bulunmuyor.</p>';
                        return;
                    }

                    tasks.forEach(task => {
                        const taskItem = document.createElement('div');
                        taskItem.classList.add('task-item');
                        taskItem.innerHTML = `
                            <div class="task-details">
                                <div class="task-title">${task.title}</div>
                                <div class="task-description">${task.description || 'A√ßƒ±klama yok'}</div>
                            </div>
                            <div class="task-status ${task.isCompleted ? 'completed' : 'pending'}">
                                ${task.isCompleted ? 'Tamamlandƒ±' : 'Devam Ediyor'}
                            </div>
                            <div class="task-actions">
                                <button class="action-btn edit-btn" data-id="${task.taskId}">‚úèÔ∏è</button>
                                <button class="action-btn delete-btn" data-id="${task.taskId}">üóëÔ∏è</button>
                                <button class="action-btn toggle-btn" data-id="${task.taskId}">
                                    ${task.isCompleted ? '‚ùå' : '‚úÖ'}
                                </button>
                            </div>
                        `;
                        taskList.appendChild(taskItem);
                    });

                    // D√ºzenleme butonlarƒ±
                    document.querySelectorAll('.edit-btn').forEach(btn => {
                        btn.addEventListener('click', () => openEditModal(btn.dataset.id));
                    });

                    // Silme butonlarƒ±
                    document.querySelectorAll('.delete-btn').forEach(btn => {
                        btn.addEventListener('click', () => deleteTask(btn.dataset.id));
                    });

                    // Durum deƒüi≈ütirme butonlarƒ±
                    document.querySelectorAll('.toggle-btn').forEach(btn => {
                        btn.addEventListener('click', () => toggleTaskStatus(btn.dataset.id));
                    });
                } catch (error) {
                    console.error('G√∂revler y√ºklenirken hata:', error);
                    alert('G√∂revler y√ºklenemedi');
                }
            }

            // Yeni g√∂rev modalƒ±nƒ± a√ß
            addTaskBtn.addEventListener('click', () => {
                modalTitle.textContent = 'Yeni G√∂rev';
                taskForm.reset();
                document.getElementById('taskId').value = '';
                taskModal.style.display = 'flex';
            });

            // Modal kapatma
            cancelTaskBtn.addEventListener('click', () => {
                taskModal.style.display = 'none';
            });

            // G√∂rev ekleme/d√ºzenleme formu submit
            taskForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const taskId = document.getElementById('taskId').value;
                const title = document.getElementById('taskTitle').value;
                const description = document.getElementById('taskDescription').value;
                const dueDate = document.getElementById('taskDueDate').value;
                const priority = document.getElementById('taskPriority').value;

                try {
                    const taskData = {
                        title,
                        description,
                        dueDate: dueDate ? new Date(dueDate).toISOString() : null,
                        priority: parseInt(priority)
                    };

                    if (taskId) {
                        // G√∂revi g√ºncelle
                        await ApiService.request(`/Tasks/${taskId}`, 'PUT', taskData, true);
                    } else {
                        // Yeni g√∂rev olu≈ütur
                        await ApiService.request('/Tasks', 'POST', taskData, true);
                    }

                    // Modal'ƒ± kapat ve g√∂revleri yeniden y√ºkle
                    taskModal.style.display = 'none';
                    loadTasks();
                } catch (error) {
                    console.error('G√∂rev kaydedilirken hata:', error);
                    alert(error.message || 'G√∂rev kaydedilemedi');
                }
            });

            // G√∂revi d√ºzenleme modalƒ±nƒ± a√ß
            async function openEditModal(taskId) {
                try {
                    const task = await ApiService.request(`/Tasks/${taskId}`, 'GET', null, true);
                    
                    modalTitle.textContent = 'G√∂revi D√ºzenle';
                    document.getElementById('taskId').value = task.taskId;
                    document.getElementById('taskTitle').value = task.title;
                    document.getElementById('taskDescription').value = task.description || '';
                    document.getElementById('taskDueDate').value = task.dueDate 
                        ? new Date(task.dueDate).toISOString().split('T')[0] 
                        : '';
                    document.getElementById('taskPriority').value = task.priority || 2;

                    taskModal.style.display = 'flex';
                } catch (error) {
                    console.error('G√∂rev bilgileri alƒ±nƒ±rken hata:', error);
                    alert('G√∂rev bilgileri alƒ±namadƒ±');
                }
            }

            // G√∂revi silme
            async function deleteTask(taskId) {
                if (!confirm('Bu g√∂revi silmek istediƒüinizden emin misiniz?')) return;

                try {
                    await ApiService.request(`/Tasks/${taskId}`, 'DELETE', null, true);
                    loadTasks();
                } catch (error) {
                    console.error('G√∂rev silinirken hata:', error);
                    alert('G√∂rev silinemedi');
                }
            }

            // G√∂rev durumunu deƒüi≈ütirme
            async function toggleTaskStatus(taskId) {
                try {
                    const task = await ApiService.request(`/Tasks/${taskId}`, 'GET', null, true);
                    
                    const endpoint = task.isCompleted 
                        ? `/Tasks/${taskId}/uncomplete` 
                        : `/Tasks/${taskId}/complete`;
                    
                    await ApiService.request(endpoint, 'PATCH', null, true);
                    loadTasks();
                } catch (error) {
                    console.error('G√∂rev durumu deƒüi≈ütirilirken hata:', error);
                    alert('G√∂rev durumu deƒüi≈ütirilemedi');
                }
            }

            // ƒ∞lk y√ºkleme
            loadTasks();
        });
    </script>
</body>
</html>